<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cyou.library.xh.borrow.dao.BorrowRecordDao">
	<resultMap type="BorrowRecordList" id="borrowMap">
		<id property="check_id" column="check_id"/>
		<result property="user_id" column="user_id"></result>
		<result property="user_realname" column="user_realname"></result>
		<result property="bookId" column="book_id"></result>
		<result property="bookName" column="book_name"></result>
		<result property="check_flag" column="check_flag"></result>
		<result property="check_requestTime" column="check_requesttime"></result>
	</resultMap>
	<insert id="addBorrowRecord" parameterType="BorrowRecord">
		insert into t_borrow (user_id,book_id,check_flag,check_requesttime,check_renew) values(#{user_id},#{book_id},1,curdate(),0);
	</insert>
	<select id="selectBorrowRecord" resultMap="borrowMap" parameterType="java.util.Map">
		select check_id,t_user.user_id,user_realname,t_book.book_id,book_name,check_flag,check_requesttime
		from t_borrow,t_book,t_user
		where t_borrow.book_id=t_book.book_id and t_borrow.user_id=t_user.user_id and check_flag=#{state}
		limit #{pageIndex},#{pageSize}
	</select>
	<select id="borrowRecordCount" resultType="int">
		select count(check_id)
		from t_borrow,t_book,t_user
		where t_borrow.book_id=t_book.book_id and t_borrow.user_id=t_user.user_id and check_flag=1
	</select>
	<select id="selectBorrowRecordById" parameterType="int" resultMap="borrowMap">
		select check_id,t_user.user_id,user_realname,t_book.book_id,book_name,check_flag,check_requesttime
		from t_borrow,t_book,t_user
		where check_id=#{checkId} and t_borrow.book_id=t_book.book_id and t_borrow.user_id=t_user.user_id
	</select>
	<update id="updateBorrowRecord" parameterType="BorrowRecord">
		update t_borrow
		<set>
			<if test="user_id!= null">user_id= #{user_id},</if>
			<if test="book_id!= null">book_id= #{book_id},</if>
			<if test="check_flag!=null">check_flag= #{check_flag},</if>
			<if test="check_requestTime!=null">check_requesttime= #{check_requestTime},</if>
			<if test="check_startTime!=null">check_starttime= #{check_startTime},</if>
			<if test="check_endTime!=null">check_endtime= #{check_endTime},</if>
			<if test="check_mailTime!=null">check_mailtime= #{check_mailTime},</if>
			<if test="check_overdue!=null">check_overdue= #{check_overdue}</if>
			<if test="check_renew!=null">check_renew= #{check_renew},</if>
		</set>
		 where check_id=#{check_id}
	</update>
	<delete id="deleteBorrowRecord" parameterType="int">
		delete from t_borrow where check_id=#{checkId}
	</delete>
</mapper>